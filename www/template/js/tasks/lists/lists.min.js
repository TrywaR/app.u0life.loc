function lists_show(t){$(this).hasClass("__list_show")?(t.html(""),$(this).removeClass("__list_show")):($(this).addClass("__list_show"),t.html(u0life.oLoadingHtm),t.lists(t.data()))}function Lists(t,s,i,o){this.sTemplate=i,this.oBlockWrap=s,this.oBlockLists={},this.oListsData=t,this.init=function(){var t=this;$.get(t.sTemplate).fail(function(s){status({error:"Шаблон не найден: "+t.sTemplate})}).done(function(s){if(!s)return!1;$.when(t.oBlockWrap.html(content_loader_elem_html(t.oListsData,$("<div/>").html(s)))).done(function(){t.oBlockLists=t.oBlockWrap.find(".block_lists"),$.when(content_download({action:"tasks_lists",form:"show",filter:{0:{name:"task_id",value:t.oListsData.task_id}}},"json",!1)).then(function(s){$.each(s,function(i,o){t.oBlockWrap.find("._lists_data").list(o),i==s.length-1&&t.oBlockWrap.find("._lists_data").sortable({handle:".__list_sort",stop:function(){t.sort()}})})}),t.oBlockLists.find(".__list_add").on("click",function(){var s=parseInt(t.oBlockWrap.find("._lists_data .block_list:last").attr("data-sort"));s>t.oBlockWrap.find("._lists_data .block_list").length?s++:s=t.oBlockWrap.find("._lists_data .block_list").length+1,$.when(content_download({action:"tasks_lists",form:"add",sort:s,task_id:t.oListsData.task_id},"json",!1)).then(function(s){if(!s.data)return!1;t.oBlockWrap.find("._lists_data").list(s.data)})})})})},this.sort=function(){this.oBlockWrap.find("._lists_data .block_list").each(function(t,s){$(s).attr("data-sort",t),content_download({action:"tasks_lists",form:"sort",sort:t,id:$(s).attr("data-id")},"json",!1)})},this.init()}$.fn.lists=function(t){new Lists(t,this,"/templates/tasks/lists/lists.htm")};