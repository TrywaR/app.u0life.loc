function List_elems(t,e,s,o){this.sTemplate=s,this.oBlockWrap=e,this.oBlockListElems={},this.oListData=t,this.init=function(){var t=this;$.get(t.sTemplate).fail(function(e){status({error:"Шаблон не найден: "+t.sTemplate})}).done(function(e){if(!e)return!1;$.when(t.oBlockWrap.html(content_loader_elem_html(t.oListData,$("<div/>").html(e)))).done(function(){t.oBlockListElems=t.oBlockWrap.find(".block_lists"),$.when(content_download({action:"tasks_lists_elems",form:"show",filter:{0:{name:"list_id",value:t.oListData.id}}},"json",!1)).then(function(e){$.each(e,function(s,o){t.oBlockWrap.find("._elems_data").list_elem(o),s==e.length-1&&t.oBlockWrap.find("._elems_data").sortable({handle:".__elem_sort",stop:function(){t.sort()}})})}),t.oBlockWrap.find(".__elem_add").on("click",function(){var e=parseInt(t.oBlockWrap.find("._elems_data .block_list_elem:last").attr("data-sort"));e>t.oBlockWrap.find("._elems_data .block_list_elem").length?e++:e=t.oBlockWrap.find("._elems_data .block_list_elem").length+1,$.when(content_download({action:"tasks_lists_elems",form:"add",sort:e,list_id:t.oListData.id},"json",!1)).then(function(e){if(!e.data)return!1;t.oBlockWrap.find("._elems_data").list_elem(e.data)})})})})},this.sort=function(){this.oBlockWrap.find("._elems_data .block_list_elem").each(function(t,e){$(e).attr("data-sort",t),content_download({action:"tasks_lists_elems",form:"sort",sort:t,id:$(e).attr("data-id")},"json",!1)})},this.init()}$.fn.list_elems=function(t){new List_elems(t,this,"/templates/tasks/lists/elems/elems.htm")};